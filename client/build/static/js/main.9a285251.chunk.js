(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{149:function(e,t,a){},151:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a(28),c=a.n(s),r=(a(97),a(38)),i=a.n(r),o=a(51),d=a(6),l=(a(99),a(160)),u=a(158),j=a(157),b=a(154),m=a(12),f=a(159),h=a(156),O=a(153),x=a(155),p=a(10),g=a.n(p),v=Object(n.createContext)(),y=Object(n.createContext)(),w=function(e){return{type:"addRoom",payload:{rooms:e}}},k=function(e,t){return{type:"addMessage",payload:{roomId:e,messages:t}}},I=function(e,t,a){return{type:"addOneMessage",payload:{roomId:e,message:t,currentChat:a}}},C=function(e,t){return{type:"addLastMessage",payload:{roomId:e,lastMessage:t}}},E=function(e){return{type:"addProfile",payload:{profile:e}}},L=function(e){return{type:"allLoaded",payload:{roomId:e}}},A=function(e,t,a){return{type:"updateStatus",payload:{roomId:e,localId:t,status:a}}},B=a(39),R=function(){var e=Object(o.a)(i.a.mark((function e(t,a,n){var s,c,r,o,d,l,u,j,b,m,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=Object(B.a)(t),e.prev=1,s.s();case 3:if((c=s.n()).done){e.next=26;break}return r=c.value,o=r.user_1!==n?r.user_1:r.user_2,e.next=8,g.a.get("user/friend/".concat(o));case 8:return d=e.sent,a((i=r._id,h=d.data,{type:"addFriend",payload:{roomId:i,friend:h}})),l={room_id:r._id,user_id:o},e.next=13,g.a.post("message/unreaded",l);case 13:if(u=e.sent,console.log(u.data),!1===u.data){e.next=20;break}j=Object(B.a)(u.data);try{for(j.s();!(b=j.n()).done;)m=b.value,a(I(r._id,m))}catch(O){j.e(O)}finally{j.f()}e.next=24;break;case 20:return e.next=22,g.a.get("message/findlast/".concat(r._id));case 22:!1!==(f=e.sent).data?a(C(r._id,f.data)):a(L(r._id));case 24:e.next=3;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(1),s.e(e.t0);case 31:return e.prev=31,s.f(),e.finish(31);case 34:case"end":return e.stop()}var i,h}),e,null,[[1,28,31,34]])})));return function(t,a,n){return e.apply(this,arguments)}}(),_=a(1),M=function(e){var t=e.show,a=e.handleClose,s=Object(f.a)(),c=Object(d.a)(s,1)[0],r=Object(n.useRef)(),i=Object(n.useState)(""),o=Object(d.a)(i,2),l=o[0],u=o[1],m=Object(n.useState)(!1),p=Object(d.a)(m,2),y=p[0],k=p[1],I=Object(n.useContext)(v).dispatch,C=Object(n.useContext)(v).rooms;function E(){u(""),k(!1),a()}return Object(_.jsxs)(h.a,{show:t,onHide:E,children:[Object(_.jsx)(h.a.Header,{closeButton:!0,children:Object(_.jsx)(h.a.Title,{children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0440\u0443\u0433\u0430"})}),Object(_.jsxs)(h.a.Body,{children:[l&&Object(_.jsx)(O.a,{variant:"danger",children:l}),Object(_.jsxs)(j.a.Group,{controlId:"exampleForm.ControlInput1",children:[Object(_.jsx)(j.a.Label,{children:"ID \u0434\u0440\u0443\u0433\u0430"}),Object(_.jsx)(j.a.Control,{ref:r,type:"text",placeholder:c.id})]})]}),Object(_.jsxs)(h.a.Footer,{children:[Object(_.jsx)(b.a,{variant:"secondary",onClick:E,children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),y?Object(_.jsx)(b.a,{disabled:!0,variant:"primary",children:Object(_.jsx)(x.a,{animation:"border",role:"status",children:Object(_.jsx)("span",{className:"sr-only",children:"Loading..."})})}):Object(_.jsx)(b.a,{variant:"primary",onClick:function(){var e=r.current.value;if(0===e.trim().length);else if(e===c.id)u("\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0435\u0431\u044f");else{var t=!1;C.map((function(a){a.friend.id===e&&(u("\u0423 \u0432\u0430\u0441 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u044d\u0442\u043e\u0442 \u0434\u0440\u0443\u0433"),t=!0)})),!1===t&&(k(!0),g.a.get("user/addcheck/".concat(e)).then((function(t){if(!1===t.data)u("\u0422\u0430\u043a\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435\u0442"),k(!1);else{var a={user_1:c.id,user_2:e};g.a.post("room/add",a).then((function(e){I(w([e.data])),R([e.data],I,c.id).then((function(){k(!1)})),E()}))}})))}},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]})]})},N={height:"100%",backgroundColor:"#F0F0F0"},S=function(e){var t=e.isLogged,a=e.changeCurrentPage,s=(e.currentPage,e.loading),c=Object(f.a)(),r=Object(d.a)(c,3),i=(r[0],r[1],r[2]),o=Object(m.b)((function(){return{transform:"translateY(".concat(t?0:"-100%",")")}})),h=Object(d.a)(o,3),O=h[0],x=h[1],p=(h[2],Object(n.useState)(!1)),g=Object(d.a)(p,2),v=g[0],y=g[1];Object(n.useEffect)((function(){x(s?{transform:"translateY(-110%)"}:{transform:"translateY(0%)"})}),[s]);return Object(_.jsxs)(m.a.div,{style:O,children:[Object(_.jsx)(M,{show:v,handleClose:function(){return y(!1)}}),Object(_.jsxs)(l.a,{expand:"lg",style:N,children:[Object(_.jsx)(l.a.Brand,{href:"#home",children:Object(_.jsx)("h2",{children:"Messenger"})}),Object(_.jsx)(l.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(_.jsxs)(l.a.Collapse,{id:"basic-navbar-nav",children:[Object(_.jsx)(u.a,{className:"mr-auto",children:t?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(u.a.Link,{href:"",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),Object(_.jsx)(u.a.Link,{href:"",onClick:function(){y(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0440\u0443\u0433\u0430"}),Object(_.jsx)(u.a.Link,{href:"",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"})]}):Object(_.jsx)("div",{})}),Object(_.jsx)(j.a,{inline:!0,children:t?Object(_.jsx)("div",{children:Object(_.jsx)(b.a,{variant:"outline-info",className:"mr-sm-2",onClick:function(){return window.location="/",void i("id")},children:"\u0412\u044b\u0445\u043e\u0434"})}):Object(_.jsxs)("div",{children:[Object(_.jsx)(b.a,{variant:"outline-info",className:"mr-sm-2",onClick:function(){return a(!0)},children:"\u0412\u043e\u0439\u0442\u0438"}),Object(_.jsx)(b.a,{variant:"outline-info",onClick:function(){return a(!1)},children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})]})})]})]})]})},D=a.p+"static/media/default.6a84b905.jpg",P={width:"50px",height:"50px",borderRadius:"50%"},G={width:"100%",listStyle:"none",marginLeft:0,paddingTop:"20px",paddingBottom:"20px",paddingRight:"10px",borderBottom:"1px solid rgb(0,0,0,0.05)"},F={color:"grey"},z={borderRadius:"50%",width:"30px",height:"30px",color:"white"},T=function(e){var t=e.ava,a=e.username,s=e.lastTextParam,c=e.time,r=e.id,i=e.unReaded,o=Object(n.useRef)(null),l=Object(n.useState)(null),u=Object(d.a)(l,2),j=u[0],b=u[1],m=Object(n.useContext)(y).setChat,f=Object(n.useState)(s),h=Object(d.a)(f,2),O=h[0],x=h[1];return Object(n.useEffect)((function(){x(s)}),[s]),Object(n.useEffect)((function(){var e=document.getElementById("lastText").clientWidth;b(Math.round(e/10));var t=window.addEventListener("resize",(function(){e=document.getElementById("lastText").clientWidth,b(Math.round(e/10))}));return function(){return window.removeEventListener("resize",t)}}),[]),Object(n.useEffect)((function(){void 0!==O&&O.length>j&&x(s.substr(0,j)+"...")}),[j,O]),Object(_.jsxs)("div",{className:"row m-0 one-user",style:G,onClick:function(){m(r)},children:[Object(_.jsx)("div",{className:"col-2 p-0 d-flex justify-content-center align-items-center",children:""!==t?Object(_.jsx)("img",{src:t,alt:"",style:P}):Object(_.jsx)("img",{src:D,alt:"",style:P})},r),Object(_.jsxs)("div",{className:"col p-0",children:[Object(_.jsx)("div",{children:a}),Object(_.jsx)("div",{ref:o,style:F,id:"lastText",children:O})]}),Object(_.jsxs)("div",{className:"col-1 p-0 d-flex flex-column align-items-center justify-content-end",children:[Object(_.jsx)("div",{children:i>0&&Object(_.jsx)("div",{className:"d-flex justify-content-center align-items-center bg-info",style:z,children:Object(_.jsx)("div",{children:i})})}),Object(_.jsx)("div",{style:F,children:c})]})]},r)},H={borderRight:"1px solid #D0D0D0"},X=function(){var e=Object(n.useContext)(v).rooms;return Object(_.jsx)("div",{className:"m-0 h-100 p-0",style:H,children:e!==[]?e.map((function(e){return Object(_.jsx)(T,{ava:e.friend.ava,username:e.friend.username,lastTextParam:void 0!==e.messages[e.messages.length-1]?e.messages[e.messages.length-1].text:"",time:void 0!==e.messages[e.messages.length-1]?e.messages[e.messages.length-1].time:"",id:e._id,unReaded:e.unReaded})})):Object(_.jsx)("div",{children:"\u0423 \u0432\u0430\u043c \u043f\u043e\u043a\u0430 \u043d\u0435\u0442 \u0434\u0440\u0443\u0437\u0435\u0439"})})},W=a(15),q=function(e){var t=e.text,a=e.time,n=e.isMy,s=e.key,c=e.id,r=e.status,i={maxWidth:"60%",borderRadius:"8px",backgroundColor:n?"#2284FF":"#F1F0F0",color:n?"white":"black"};return!1===n&&(r=-1),Object(_.jsxs)("div",{className:"d-flex flex-column w-100 p-1",style:{alignItems:n?"flex-end":"flex-start"},id:c,children:[Object(_.jsx)("div",{className:"p-2",style:i,children:Object(_.jsx)("div",{children:t})}),Object(_.jsxs)("div",{className:"d-flex",children:[Object(_.jsx)("div",{style:{color:"grey",fontSize:"12px",marginRight:"10px"},children:a}),0===r?Object(_.jsx)("img",{src:"https://img.icons8.com/carbon-copy/100/000000/clock--v1.png",alt:"status",style:{width:"15px",height:"15px"}}):1===r?Object(_.jsx)("img",{src:"https://img.icons8.com/ios/50/000000/checkmark--v1.png",alt:"status",style:{width:"15px",height:"15px",transform:"rotate(5deg)"}}):2===r?Object(_.jsx)("img",{src:"https://img.icons8.com/ios-filled/50/000000/double-tick.png",alt:"status",style:{width:"15px",height:"15px"}}):3===r?Object(_.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAADvElEQVRoge2YTWgcZRjH/8873bTWgm0PitgqmpnY0kttdrMNhR6KUAQpFhNqpNQGtDOBBovgx6UqePBSKkjDftQvJKJJi6SVUhAKimJNdxa8pJDdTQuuUnqIFg/GJrPzeDDBdybZ3XlnN7s9zO/439/OPn/mnXlfFoiIiIiIiIgAtXsAmV2pwrMClAGhAkGmfUy/HNS9Z4rEU9M9IPE9gHWLUdm2jEeDuqIVQ9ajNzX9CEibwP+DAQRXxW17kd7T5fsWSEwA/LAUMzG9qeK2twgzLay/+zGAuDfH+zlLH1Nx21okkSmdBHjAF1+wb+snVd22FelJlQ4y8I6cMXBdm8cRvEuuqtuWt1YiW9jJLv0I4H4pnmVCMm8aM2Hclt+R5NkbD7FLF3yDLYDR5y+h4ra0yI7xqY5KpTIOwLM/ENFxe8j4LqwLtLjI+tmOEQB7PSHhg5ypZxtxgRYWiWcKrzPhZV/87YZbv73RiLtESx72XanifkG4BECTfnraWavt/mXw8TthXZlVL9Kdmd5GLH4G8ID0o38KiOSk1VkM6/pZ1aXV+9HUZoL4Rh4MgAOIfv9gKu5KrGnOyMvpztgxx+k4B0D3fEA4kTM7r4R1q7Fqd4R444cM7POG+MQ2jZFG3GqsSpHudGkYYEvOCPTD3Kb5oUbcWlA8W3oGLmcBgImG86Y+EWb4JRLZwtPs0mV4l+2McJzktePbZ8O69RCLJbYA2ELM5xLp0qGwJZLpGQMujfsG+0sDDvgHU3GD4F9aaxg8GqbMzk9vbqzAvcjAJimuMPGLk5ZxPawbFMFEwwAcKVMu0z/OWuyu8xWAbXJOoLfyZtelsK4KYvGZGMDyMl8k0sXDQS5y84/SKQb2++LPc5Z+qhFXBQEAtmWcx/IyGgOf1SuTSBWOAjjhCRk/3ZnHsUZcVTxHlHi62AfgS3gfwAoBR3OWMer/cjxV2gPiKwDWSvGvmqb1TL7yxO2wbhg8D7vKnXnqzI3HiPhr32BzAuJ5/2AqblOKAMHK7BiZ2qDFnIsMPCg5TKDBa1anLV9PxW2EqqffRLp0iMGj8C4zB+AjIHoBjAOyz8Rv582u9+QNlsCvMtFL1dxmlahZBKhaZiXGbFMfABHH08Uy/ttg67qqw9ai5lkrZ+ljBDoM7zLzY8f+XjcYcDAVV4m6h8baZehWjN3nrr62dW4pWWGDreo2k0Cn38W/L/0vgH+Y3INXh578XXarbLArus0k8DHetozzTNQPoAygzMR9ebNrslE3IiIiIiLiXuBf/msgy1as/bgAAAAASUVORK5CYII=",alt:"status",style:{width:"15px",height:"15px"}}):Object(_.jsx)("div",{})]})]},s)},K=a(91),Z=a.n(K)()(),Y=0,V=!0,U=!1,J=!1,Q="",$=!1,ee=function(){var e=Object(n.useRef)(null),t=Object(f.a)(),a=Object(d.a)(t,1)[0],s=Object(n.useContext)(v),c=s.rooms,r=s.dispatch,i=Object(n.useState)([]),o=Object(d.a)(i,2),l=o[0],u=o[1],j=Object(n.useState)(!1),b=Object(d.a)(j,2),m=b[0],h=b[1],O=Object(n.useContext)(y).chat;return Object(n.useEffect)((function(){if(""!==Q){var e=Math.ceil(document.getElementById("messageBlock").scrollTop+document.getElementById("messageBlock").clientHeight);document.getElementById("messageBlock").scrollHeight-e<30&&(J=!0),c.forEach((function(e){e._id===O&&(U=e.allLoaded,u(Object(W.a)(e.messages)),0!==e.unReaded&&r({type:"removeUnReaded",payload:{roomId:Q}}),e.messages.forEach((function(e){2===e.status&&e.user_id!==a.id&&Z.emit("readed",e._id)})))}))}}),[c]),Object(n.useEffect)((function(){""!==Q&&(Y=l.length,console.log(Y),V?(e.current.scrollIntoView(),V=!1):J?(e.current.scrollIntoView(),J=!1):$&&(document.getElementById("messageBlock").scrollTop=document.getElementById("scroll").offsetTop,$=!1))}),[l]),Object(n.useEffect)((function(){if(""!==O){Q=O,c!==[]&&c.forEach((function(e){e._id===O&&(U=e.allLoaded,Y=e.messages.length,u(Object(W.a)(e.messages)),e.messages.forEach((function(e){2===e.status&&e.user_id!==a.id&&Z.emit("readed",e._id)})))}));var e=!1;if(c.forEach((function(t){t._id===O&&(e=t.loaded)})),!1===e&&!1===U){var t={room_id:O,skip:Y,limit:20};h(!0),g.a.post("message/find",t).then((function(e){!1!==e.data?(r(k(O,e.data)),h(!1),e.data.length<20&&r(L(Q))):h(!1),r({type:"loaded",payload:{roomId:O}})}))}}return function(){Y=0,V=!0,U=!1,J=!1,$=!1}}),[O]),Object(n.useEffect)((function(){document.getElementById("messageBlock").addEventListener("scroll",(function(e){if(0===e.target.scrollTop&&""!==Q&&e.target.scrollHeight>e.target.clientHeight){var t={room_id:Q,skip:Y,limit:20};!1===U&&(h(!0),g.a.post("message/find",t).then((function(e){!1!==e.data&&null!==e.data?(e.data[e.data.length-1].isLast=!0,$=!0,r(k(Q,e.data)),h(!1),e.data.length<20&&r(L(Q))):(U=!0,h(!1))})))}}))}),[]),Object(_.jsxs)("div",{className:"w-100 p-1",style:{flexBasis:"90%",overflow:"auto"},id:"messageBlock",children:[m&&Object(_.jsxs)("div",{className:"d-flex justify-content-center mt-3",children:[Object(_.jsx)(x.a,{animation:"grow",size:"sm",variant:"info"}),Object(_.jsx)(x.a,{animation:"grow",size:"sm",variant:"info"}),Object(_.jsx)(x.a,{animation:"grow",size:"sm",variant:"info"})]}),l!==[]?l.map((function(e){return e.isLast?Object(_.jsx)(q,{id:"scroll",text:e.text,time:e.time,isMy:e.user_id===a.id,status:e.status},e.local_id):Object(_.jsx)(q,{text:e.text,time:e.time,isMy:e.user_id===a.id,status:e.status},e.local_id)})):Object(_.jsx)("div",{}),Object(_.jsx)("div",{ref:e,id:"lastMessage"})]})},te="",ae=function(){var e=Object(n.useState)(0),t=Object(d.a)(e,2),a=t[0],s=t[1],c=Object(f.a)(),r=Object(d.a)(c,2),i=r[0],o=(r[1],Object(n.useContext)(v).dispatch),l=Object(n.useRef)(""),u=Object(n.useContext)(y).chat;function j(){if(null!==l.current){var e=l.current.value.trim();if(""!==e){var t=new Date,a={local_id:Date.now().toString(),room_id:te,user_id:i.id,status:0,text:e,time:t.getHours()+":"+t.getMinutes()};o({type:"changeRoom",payload:{roomId:n}}),o(I(te,a)),Z.emit("message",a),l.current.value="",s(0)}}var n}return Object(n.useEffect)((function(){var e;return""!==(te=u)&&(e=document.addEventListener("keypress",(function(e){13===e.keyCode&&(e.preventDefault(),j())}))),function(){return document.removeEventListener("keypress",e)}}),[u]),Object(n.useEffect)((function(){a>=50&&(document.getElementById("messageBlock").scrollTop=document.getElementById("messageBlock").scrollHeight)}),[a]),Object(_.jsx)("div",{className:"d-flex justify-content-end pl-2 pr-2",id:"textarea",style:{flexBasis:a<50?"10%":"30%",backgroundColor:"#F0F0F0"},children:Object(_.jsxs)("div",{className:"h-100 d-flex w-100 align-items-center",children:[Object(_.jsx)("textarea",{onChange:function(e){return s(e.target.value.length)},ref:l,style:{width:"95%",resize:"none",height:"70%",padding:"10px",borderRadius:"20px",outline:"none",borderColor:"#C0C0C0"},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"}),Object(_.jsx)("img",{className:"send",onClick:function(){return j()},src:"https://img.icons8.com/dotty/80/000000/paper-plane.png",alt:"send",style:{width:"5%"}})]})})},ne={},se=function(){var e=Object(n.useContext)(y).chat;return Object(_.jsx)("div",{className:"m-0 p-0 h-100",style:ne,children:""!==e?Object(_.jsxs)("div",{className:"h-100 d-flex flex-column",children:[Object(_.jsx)(ee,{chat:e}),Object(_.jsx)(ae,{})]}):Object(_.jsx)("div",{})})},ce={height:"90%"},re=function(e){var t=e.loading,a=e.rooms,s=e.setCurrentChat,c=Object(m.b)((function(){return{transform:"translateX(-100%)"}})),r=Object(d.a)(c,3),i=r[0],o=r[1],l=r[2],u=Object(m.b)((function(){return{transform:"translateX(100%)"}})),j=Object(d.a)(u,3),b=j[0],f=j[1],h=j[2],O=Object(n.useState)(""),x=Object(d.a)(O,2),p=x[0],g=x[1];return Object(n.useEffect)((function(){s(p)}),[p]),Object(n.useEffect)((function(){!1===t&&(o({transform:"translateX(0%)"}),f({transform:"translateX(0%)"})),l(),h()}),[t]),Object(_.jsx)(y.Provider,{value:{chat:p,setChat:g},children:Object(_.jsxs)("div",{style:ce,className:"row m-0 p-0",children:[Object(_.jsx)(m.a.div,{className:"col-4 p-0 m-0 h-100",style:i,children:Object(_.jsx)(X,{rooms:a})}),Object(_.jsx)(m.a.div,{className:"col p-0 m-0 h-100",style:b,children:Object(_.jsx)(se,{})})]})})},ie=a(161),oe={width:"80%"},de=function(){var e=Object(n.useRef)(""),t=Object(n.useRef)(""),a=Object(n.useState)(null),s=Object(d.a)(a,2),c=s[0],r=s[1],i=Object(f.a)(),o=Object(d.a)(i,2),l=(o[0],o[1]),u=Object(n.useState)(!1),m=Object(d.a)(u,2),h=m[0],p=m[1];return Object(_.jsx)("div",{style:oe,children:Object(_.jsx)(ie.a,{style:{width:"100%"},children:Object(_.jsxs)(ie.a.Body,{children:[Object(_.jsx)(ie.a.Title,{children:Object(_.jsx)("h2",{children:"\u0412\u0445\u043e\u0434"})}),Object(_.jsx)(ie.a.Subtitle,{children:c&&Object(_.jsx)(O.a,{variant:"danger",children:c})}),Object(_.jsx)(ie.a.Text,{children:Object(_.jsxs)(j.a,{children:[Object(_.jsxs)(j.a.Group,{controlId:"formBasicEmail",children:[Object(_.jsx)(j.a.Label,{children:"Email"}),Object(_.jsx)(j.a.Control,{ref:e,type:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 email"})]}),Object(_.jsxs)(j.a.Group,{controlId:"formBasicPassword",children:[Object(_.jsx)(j.a.Label,{children:"\u041f\u0430\u0440\u043e\u043b\u044c"}),Object(_.jsx)(j.a.Control,{ref:t,type:"password",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"})]}),Object(_.jsx)(j.a.Group,{controlId:"formBasicCheckbox",children:Object(_.jsx)(j.a.Check,{type:"checkbox",label:"\u0417\u0430\u043f\u043e\u043c\u0438\u043d\u0438\u0442\u044c \u043c\u0435\u043d\u044f"})}),h?Object(_.jsxs)(b.a,{variant:"primary",type:"button",disabled:!0,children:[Object(_.jsx)(x.a,{animation:"grow",variant:"info",size:"sm"}),Object(_.jsx)(x.a,{animation:"grow",variant:"info",size:"sm"}),Object(_.jsx)(x.a,{animation:"grow",variant:"info",size:"sm"})]}):Object(_.jsx)(b.a,{variant:"primary",type:"button",onClick:function(){return function(){var a={email:e.current.value.trim(),password:t.current.value.trim()};0===a.email.length?r("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 email"):0===a.password.length?r("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"):(p(!0),g.a.post("/user/login",a).then((function(e){p(!1),!1===e.data?r("\u0422\u0430\u043a\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435\u0442"):l("id",e.data)})))}()},children:"\u0412\u043e\u0439\u0442\u0438"})]})}),Object(_.jsx)(ie.a.Link,{children:"\u0417\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c?"})]})})})},le={width:"80%"},ue=function(){var e=Object(n.useRef)(""),t=Object(n.useRef)(""),a=Object(n.useRef)(""),s=Object(n.useRef)(""),c=Object(n.useState)(null),r=Object(d.a)(c,2),i=r[0],o=r[1],l=Object(f.a)(),u=Object(d.a)(l,2),m=(u[0],u[1]),h=Object(n.useState)(!1),p=Object(d.a)(h,2),v=p[0],y=p[1];return Object(_.jsx)("div",{style:le,children:Object(_.jsx)(ie.a,{style:{width:"100%"},children:Object(_.jsxs)(ie.a.Body,{children:[Object(_.jsx)(ie.a.Title,{children:Object(_.jsx)("h2",{children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})}),Object(_.jsx)(ie.a.Subtitle,{children:i&&Object(_.jsx)(O.a,{variant:"danger",children:i})}),Object(_.jsx)(ie.a.Text,{children:Object(_.jsxs)(j.a,{children:[Object(_.jsxs)(j.a.Group,{controlId:"formBasicEmail",children:[Object(_.jsx)(j.a.Label,{children:"Email"}),Object(_.jsx)(j.a.Control,{ref:e,type:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 email"})]}),Object(_.jsxs)(j.a.Group,{controlId:"formBasicEmail",children:[Object(_.jsx)(j.a.Label,{children:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"}),Object(_.jsx)(j.a.Control,{ref:t,type:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"})]}),Object(_.jsxs)(j.a.Group,{controlId:"formBasicPassword",children:[Object(_.jsx)(j.a.Label,{children:"\u041f\u0430\u0440\u043e\u043b\u044c"}),Object(_.jsx)(j.a.Control,{ref:a,type:"password",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"})]}),Object(_.jsxs)(j.a.Group,{controlId:"formBasicPassword",children:[Object(_.jsx)(j.a.Label,{children:"\u041f\u043e\u0432\u0442\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"}),Object(_.jsx)(j.a.Control,{ref:s,type:"password",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"})]}),v?Object(_.jsxs)(b.a,{variant:"primary",type:"button",disabled:!0,children:[Object(_.jsx)(x.a,{animation:"grow",variant:"info",size:"sm"}),Object(_.jsx)(x.a,{animation:"grow",variant:"info",size:"sm"}),Object(_.jsx)(x.a,{animation:"grow",variant:"info",size:"sm"})]}):Object(_.jsx)(b.a,{variant:"primary",type:"button",onClick:function(){return function(){var n={email:e.current.value.trim(),username:t.current.value.trim(),password:a.current.value.trim()};n.username.length<5?o("\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 5 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"):n.email.length<5?o("Email \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 5 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"):n.password.length<6?o("\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 6 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"):0===s.current.value.trim()?o("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):s.current.value.trim()!==n.password?o("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):(y(!0),g.a.post("/user/check",{email:n.email,username:n.username}).then((function(e){!0!==e.data?(o(e.data),y(!1)):(y(!0),g.a.post("/user/add",n).then((function(e){y(!1),m("id",e.data)})))})))}()},children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]})})]})})})},je={height:"90%"},be=function(e){var t=e.currentPage,a=Object(m.b)((function(){return{width:"100vw",transform:"translateX(50%)",opacity:1}})),s=Object(d.a)(a,3),c=s[0],r=s[1],i=s[2],o=Object(m.b)((function(){return{width:"100vw",transform:"translateX(100%)",opacity:0}})),l=Object(d.a)(o,3),u=l[0],j=l[1],b=l[2];return Object(n.useEffect)((function(){t?(r({transform:"translateX(50%)",opacity:1}),j({transform:"translateX(100%)",opacity:0})):(r({transform:"translateX(-100%)",opacity:0}),j({transform:"translateX(-50%)",opacity:1})),i(),b()}),[t]),Object(_.jsxs)("div",{className:"d-flex align-items-center bg-light",style:je,children:[Object(_.jsx)(m.a.div,{style:c,className:"d-flex justify-content-center",children:Object(_.jsx)(de,{})}),Object(_.jsx)(m.a.div,{style:u,className:"w-100 d-flex justify-content-center",children:Object(_.jsx)(ue,{})})]})},me=a(92),fe=a(162),he=(a(149),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"deleteRooms":return e=[];case"addRoom":return t.payload.rooms.map((function(e){e.messages=[],e.friend={},e.loaded=!1,e.allLoaded=!1,e.unReaded=0})),e.concat(t.payload.rooms);case"addMessage":var a=Object(W.a)(e);return a.map((function(e){return e._id===t.payload.roomId&&(e.messages=t.payload.messages.concat(e.messages)),e})),a;case"addOneMessage":var n=Object(W.a)(e);return n.map((function(e){return e._id===t.payload.roomId&&(e.messages.push(t.payload.message),e.time=Date.now(),g.a.get("/room/time/".concat(e._id)),1===t.payload.message.status&&t.payload.message.user_id===e.friend.id&&t.payload.currentChat!==e._id&&(e.unReaded=e.unReaded+1,console.log("Onee"))),e})),n.sort((function(e,t){return e.time-t.time})),n.reverse(),n;case"addLastMessage":return e.map((function(e){return e._id===t.payload.roomId&&(e.messages=t.payload.lastMessage),e})),e.sort((function(e,t){return e.time-t.time})),e.reverse(),e;case"addFriend":return e.map((function(e){return e._id===t.payload.roomId&&(e.friend=t.payload.friend),e}));case"updateStatus":var s=Object(W.a)(e);return s.map((function(e){if(e._id===t.payload.roomId)return e.messages.map((function(e){return e.local_id===t.payload.localId&&(e.status=t.payload.status),e}))})),s;case"setUnReaded":return e.map((function(e){return e._id===t.payload.roomId&&(e.unReaded=t.payload.unReaded),e}));case"removeUnReaded":return e.map((function(e){return e._id===t.payload.roomId&&(e.unReaded=0),e}));case"loaded":return e.map((function(e){return e._id===t.payload.roomId&&(e.loaded=!0),e}));case"allLoaded":return e.map((function(e){return e._id===t.payload.roomId&&(e.allLoaded=!0),e}));default:return e}}),Oe=function(e,t){switch(t.type){case"addProfile":return t.payload.profile;default:return e}},xe={width:"100vw",height:"100vh"},pe={top:0,left:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},ge=[],ve="";var ye=function(){var e=Object(n.useState)(null),t=Object(d.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(!1),r=Object(d.a)(c,2),l=r[0],u=r[1],j=Object(n.useState)(!0),b=Object(d.a)(j,2),h=b[0],O=b[1],p=Object(f.a)(),y=Object(d.a)(p,1)[0],k=Object(n.useState)(0),C=Object(d.a)(k,2),L=C[0],B=C[1],M=Object(n.useReducer)(he,[]),N=Object(d.a)(M,2),D=N[0],P=N[1],G=Object(n.useReducer)(Oe,{}),F=Object(d.a)(G,2),z=(F[0],F[1]),T=Object(m.b)((function(){return{transform:"translateY(100%)"}})),H=Object(d.a)(T,3),X=H[0],W=H[1],q=H[2];function K(){return(K=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.get("room/find/".concat(y.id));case 2:return t=e.sent,B(20),e.next=6,g.a.get("user/profile/".concat(y.id));case 6:if(a=e.sent,B(60),z(E(a.data)),!1===t.data){e.next=14;break}return P(w(t.data)),e.next=13,R(t.data,P,y.id);case 13:B(100);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){""!==y.id&&y.id?(u(!0),s(!0),function(){return K.apply(this,arguments)}().then((function(){setTimeout((function(){s(!1)}),500)}))):u(!1)}),[y]),Object(n.useEffect)((function(){W(a?{transform:"translateY(100%)"}:{transform:"translateY(0%)"}),q()}),[a]),Object(n.useEffect)((function(){return Z.on("newMessage",(function(e){ge!==[]&&y.id&&ge.map((function(t){e.user_id===t.friend.id&&e.room_id===t._id&&P(I(t._id,e,ve))}))})),Z.on("updateStatus",(function(e){ge!==[]&&y.id&&ge.forEach((function(t){e.room_id===t._id&&e.status&&t.messages.forEach((function(t){t.local_id===e.local_id&&e.status>=t.status&&P(A(e.room_id,e.local_id,e.status))}))}))})),function(){P({type:"deleteRooms"}),Z.removeAllListeners()}}),[]),Object(n.useEffect)((function(){return(ge=D)!==[]&&ge.map((function(e){e.messages.map((function(t){t.user_id!==y.id&&1===t.status&&(Z.emit("here",t._id),P(A(e._id,t.local_id,2)))}))})),function(){ge=[]}}),[D]),Object(_.jsx)(v.Provider,{value:{rooms:D,dispatch:P},children:Object(_.jsxs)("div",{style:xe,children:[Object(_.jsx)(S,{isLogged:l,changeCurrentPage:function(e){O(e)},currentPage:h,loading:a}),l?Object(_.jsx)(re,{loading:a,rooms:D,setCurrentChat:function(e){ve=e}}):Object(_.jsx)(m.a.div,{className:"h-100",style:X,children:Object(_.jsx)(be,{currentPage:h})}),!0===a?Object(_.jsx)("div",{style:pe,children:Object(_.jsx)(me.Spring,{from:{opacity:0},to:{opacity:1},children:function(e){return Object(_.jsx)("div",{style:e,className:"w-100 d-flex justify-content-center",children:Object(_.jsxs)("div",{className:"w-50 d-flex align-items-center flex-column",children:[Object(_.jsx)(x.a,{animation:"border",role:"status",variant:"info",children:Object(_.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(_.jsx)("div",{className:"w-75 m-5",children:Object(_.jsx)(fe.a,{now:L})})]})})}})}):Object(_.jsx)("div",{})]})})},we=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,163)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,c=t.getLCP,r=t.getTTFB;a(e),n(e),s(e),c(e),r(e)}))};c.a.render(Object(_.jsx)(ye,{}),document.getElementById("root")),we()},97:function(e,t,a){}},[[151,1,2]]]);
//# sourceMappingURL=main.9a285251.chunk.js.map