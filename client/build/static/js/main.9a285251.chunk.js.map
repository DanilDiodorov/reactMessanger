{"version":3,"sources":["context.js","redux/actions.js","UseRoom.js","components/AddFriend.js","components/Header.js","images/default.jpg","components/OneUser.js","components/Sidebar.js","components/OneMessage.js","images/readed-icon.png","socket.js","components/MessageBlock.js","components/MessageInput.js","components/Main.js","components/Logged.js","components/Login.js","components/SignIn.js","components/UnLogged.js","redux/reducers.js","App.js","reportWebVitals.js","index.js"],"names":["StoreContext","createContext","ChatContext","addRoom","rooms","type","payload","addMessage","roomId","messages","addOneMessage","message","currentChat","addLastMessage","lastMessage","addProfile","profile","changeAllLoaded","updateStatus","localId","status","UseRoom","dispatch","id","a","oneRoom","friendId","user_1","user_2","axios","get","findFriend","_id","friend","data","findUnReadedData","room_id","user_id","post","findUnReaded","console","log","oneMessage","findLastMessage","AddFriend","show","handleClose","useCookies","cookie","idRef","useRef","useState","error","setError","loading","setLoading","useContext","close","Modal","onHide","Header","closeButton","Title","Body","Alert","variant","Form","Group","controlId","Label","Control","ref","placeholder","Footer","Button","onClick","disabled","Spinner","animation","role","className","current","value","trim","length","isFriend","map","then","addData","style","height","backgroundColor","isLogged","changeCurrentPage","currentPage","removeCookie","useSpring","transform","header","setHeader","setShow","useEffect","div","Navbar","expand","Brand","href","Toggle","aria-controls","Collapse","Nav","Link","inline","window","location","imageStyle","width","borderRadius","listStyle","marginLeft","paddingTop","paddingBottom","paddingRight","borderBottom","textColor","color","newMessageCount","OneUser","ava","username","lastTextParam","time","unReaded","size","setSize","setChat","lastText","setLastText","document","getElementById","clientWidth","Math","round","listener","addEventListener","removeEventListener","undefined","substr","src","alt","Default","borderRight","Sidebar","text","OneMessage","isMy","key","messageStyle","maxWidth","alignItems","fontSize","marginRight","socket","io","skipCount","isFirst","allLoaded","canScroll","canScrollToLast","MessageBlock","messageRef","setMessages","chat","ceil","scrollTop","clientHeight","scrollHeight","forEach","emit","scrollIntoView","offsetTop","loaded","findData","skip","limit","e","target","isLast","flexBasis","overflow","local_id","MessageInput","textRef","sendHandler","date","Date","now","toString","getHours","getMinutes","keyCode","preventDefault","onChange","resize","padding","outline","borderColor","Main","Logged","setCurrentChat","sideBar","setSideBar","stopSideBar","stopHeader","Provider","Login","email","password","setCookie","Card","Subtitle","Text","Check","label","loginHandler","SignIn","password_2","signInHandler","UnLogged","opacity","loginAnim","setLoginAnim","stopLoginAnim","signInAnim","setSignInAnim","stopSignInAnim","roomReducer","state","action","concat","newState3","newState","push","sort","b","reverse","newState2","profileReducer","mainBlock","loadingStyle","top","left","position","display","justifyContent","localRooms","App","setIsLogged","setCurrentPage","progress","setProgress","useReducer","profileDispatch","unLogged","setUnLogged","stopUnLogged","findRooms","findProfile","getData","setTimeout","on","removeAllListeners","page","curChat","from","to","props","ProgressBar","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render"],"mappings":"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","file":"static/js/main.9a285251.chunk.js","sourcesContent":["import {createContext} from \"react\"\r\nexport const StoreContext = createContext()\r\nexport const ChatContext = createContext()\r\n","export const addRoom = (rooms) => {\r\n    return {\r\n        type: 'addRoom',\r\n        payload: {\r\n            rooms\r\n        }\r\n    }\r\n}\r\n\r\nexport const addMessage = (roomId, messages) => {\r\n    return {\r\n        type: 'addMessage',\r\n        payload: {\r\n            roomId,\r\n            messages\r\n        }\r\n    }\r\n}\r\n\r\nexport const addOneMessage = (roomId, message, currentChat) => {\r\n    return {\r\n        type: 'addOneMessage',\r\n        payload: {\r\n            roomId,\r\n            message,\r\n            currentChat: currentChat\r\n        }\r\n    }\r\n}\r\n\r\nexport const addLastMessage = (roomId, lastMessage) => {\r\n    return {\r\n        type: 'addLastMessage',\r\n        payload: {\r\n            roomId,\r\n            lastMessage\r\n        }\r\n    }\r\n}\r\n\r\nexport const addFriend = (roomId, friend) => {\r\n    return {\r\n        type: 'addFriend',\r\n        payload: {\r\n            roomId,\r\n            friend\r\n        }\r\n    }\r\n}\r\n\r\nexport const addProfile = (profile) => {\r\n    return {\r\n        type: 'addProfile',\r\n        payload: {\r\n            profile\r\n        }\r\n    }\r\n}\r\n\r\nexport const changeLoaded = (roomId) => {\r\n    return {\r\n        type: 'loaded',\r\n        payload: {\r\n            roomId\r\n        }\r\n    }\r\n}\r\n\r\nexport const changeAllLoaded = (roomId) => {\r\n    return {\r\n        type: 'allLoaded',\r\n        payload: {\r\n            roomId\r\n        }\r\n    }\r\n}\r\n\r\nexport const changeRoom = (roomId) => {\r\n    return {\r\n        type: 'changeRoom',\r\n        payload: {\r\n            roomId\r\n        }\r\n    }\r\n}\r\n\r\nexport const updateStatus = (roomId, localId, status) => {\r\n    return {\r\n        type: 'updateStatus',\r\n        payload: {\r\n            roomId,\r\n            localId,\r\n            status\r\n        }\r\n    }\r\n}\r\n\r\nexport const setUnReaded = (roomId, unReaded) => {\r\n    return {\r\n        type: 'setUnReaded',\r\n        payload: {\r\n            roomId,\r\n            unReaded\r\n        }\r\n    }\r\n}\r\n\r\nexport const removeUnReaded = (roomId) => {\r\n    return {\r\n        type: 'removeUnReaded',\r\n        payload: {\r\n            roomId\r\n        }\r\n    }\r\n}\r\n\r\nexport const deleteRooms = () => {\r\n    return {\r\n        type: 'deleteRooms'\r\n    }\r\n}\r\n","import axios from \"axios\";\r\nimport {addFriend, addLastMessage, addOneMessage, changeAllLoaded, setUnReaded} from \"./redux/actions\";\r\n\r\nconst UseRoom = async (rooms, dispatch, id) => {\r\n    for (const oneRoom of rooms) {\r\n        const friendId = oneRoom.user_1 !== id ? oneRoom.user_1 : oneRoom.user_2\r\n        const findFriend = await axios.get(`user/friend/${friendId}`)\r\n        dispatch(addFriend(oneRoom._id, findFriend.data))\r\n\r\n        const findUnReadedData = {\r\n            room_id: oneRoom._id,\r\n            user_id: friendId\r\n        }\r\n        const findUnReaded = await axios.post('message/unreaded', findUnReadedData)\r\n        console.log(findUnReaded.data)\r\n        if (findUnReaded.data !== false){\r\n            // dispatch(setUnReaded(oneRoom._id, findUnReaded.data.length))\r\n            for (const oneMessage of findUnReaded.data){\r\n                dispatch(addOneMessage(oneRoom._id, oneMessage))\r\n            }\r\n        }\r\n        else {\r\n            const findLastMessage = await axios.get(`message/findlast/${oneRoom._id}`)\r\n            if (findLastMessage.data !== false){\r\n                dispatch(addLastMessage(oneRoom._id, findLastMessage.data))\r\n            }\r\n            else {\r\n                dispatch(changeAllLoaded(oneRoom._id))\r\n            } \r\n        }\r\n    }\r\n}\r\n\r\nexport default UseRoom\r\n","import React, {useContext, useRef, useState} from \"react\"\r\nimport {Button, Modal, Form, Alert, Spinner} from \"react-bootstrap\";\r\nimport {useCookies} from \"react-cookie\";\r\nimport axios from \"axios\";\r\nimport {StoreContext} from \"../context\";\r\nimport {addRoom} from \"../redux/actions\";\r\nimport useRoom from \"../UseRoom\";\r\nimport UseRoom from \"../UseRoom\";\r\n\r\nexport const AddFriend = ({show, handleClose}) => {\r\n    const [cookie] = useCookies()\r\n    const idRef = useRef()\r\n    const [error, setError] = useState('')\r\n    const [loading, setLoading] = useState(false)\r\n    const {dispatch} = useContext(StoreContext)\r\n    const {rooms} = useContext(StoreContext)\r\n\r\n    function addHandler() {\r\n        const friendId = idRef.current.value\r\n        if (friendId.trim().length === 0){\r\n\r\n        }\r\n        else if (friendId === cookie.id){\r\n            setError('Нельзя добавить себя')\r\n        }\r\n        else {\r\n            let isFriend = false\r\n            rooms.map(oneRoom => {\r\n                if (oneRoom.friend.id === friendId){\r\n                    setError('У вас уже есть этот друг')\r\n                    isFriend = true\r\n                }\r\n            })\r\n            if (isFriend === false){\r\n                setLoading(true)\r\n                axios.get(`user/addcheck/${friendId}`).then(data => {\r\n                    if (data.data === false){\r\n                        setError('Такого пользователя нет')\r\n                        setLoading(false)\r\n                    }\r\n                    else {\r\n                        const addData = {\r\n                            user_1: cookie.id,\r\n                            user_2: friendId\r\n                        }\r\n                        axios.post('room/add', addData).then(data => {\r\n                            dispatch(addRoom([data.data]))\r\n                            UseRoom([data.data], dispatch, cookie.id)\r\n                                .then(() => {\r\n                                    setLoading(false)\r\n                                })\r\n                            close()\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    function close() {\r\n        setError('')\r\n        setLoading(false)\r\n        handleClose()\r\n    }\r\n\r\n    return (\r\n        <Modal show={show} onHide={close}>\r\n            <Modal.Header closeButton>\r\n                <Modal.Title>Добавить друга</Modal.Title>\r\n            </Modal.Header>\r\n            <Modal.Body>\r\n                {error && (\r\n                    <Alert variant='danger'>{error}</Alert>\r\n                )}\r\n                <Form.Group controlId=\"exampleForm.ControlInput1\">\r\n                    <Form.Label>ID друга</Form.Label>\r\n                    <Form.Control ref={idRef} type=\"text\" placeholder={cookie.id} />\r\n                </Form.Group>\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                <Button variant=\"secondary\" onClick={close}>\r\n                    Отмена\r\n                </Button>\r\n                {loading ? (\r\n                    <Button disabled variant=\"primary\">\r\n                        <Spinner animation=\"border\" role=\"status\">\r\n                            <span className=\"sr-only\">Loading...</span>\r\n                        </Spinner>\r\n                    </Button>\r\n                ) : (\r\n                    <Button variant=\"primary\" onClick={addHandler}>\r\n                        Добавить\r\n                    </Button>\r\n                )}\r\n\r\n            </Modal.Footer>\r\n        </Modal>\r\n    )\r\n}\r\n","import React, {useEffect, useState} from 'react'\r\nimport {Navbar, Nav, Form, Button, Modal} from \"react-bootstrap\";\r\nimport {useSpring, animated} from \"react-spring\";\r\nimport {useCookies} from \"react-cookie\";\r\nimport {AddFriend} from \"./AddFriend\";\r\n\r\nconst style = {\r\n    height: '100%',\r\n    backgroundColor: '#F0F0F0'\r\n}\r\n\r\nconst drop = {\r\n    zIndex: 999\r\n}\r\n\r\nexport const Header = ({isLogged, changeCurrentPage, currentPage, loading}) => {\r\n    const [cookie, setCookie, removeCookie] = useCookies()\r\n    const [header, setHeader, stopHeader] = useSpring(() => ({\r\n        transform: `translateY(${isLogged ? 0 : '-100%'})`\r\n    }))\r\n    const [show, setShow] = useState(false)\r\n\r\n    useEffect(() => {\r\n        if (loading){\r\n            setHeader({\r\n                transform: 'translateY(-110%)'\r\n            })\r\n        }\r\n        else {\r\n            setHeader({\r\n                transform: 'translateY(0%)'\r\n            })\r\n        }\r\n    }, [loading])\r\n\r\n    function exit() {\r\n        window.location = '/'\r\n        removeCookie('id')\r\n    }\r\n\r\n    function addFriendHandler() {\r\n        setShow(true)\r\n    }\r\n    const handleClose = () => setShow(false)\r\n\r\n    return (\r\n        <animated.div style={header}>\r\n            <AddFriend show={show} handleClose={handleClose}/>\r\n            <Navbar expand=\"lg\"  style={style}>\r\n                <Navbar.Brand href=\"#home\"><h2>Messenger</h2></Navbar.Brand>\r\n                <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\r\n                <Navbar.Collapse id=\"basic-navbar-nav\">\r\n                    <Nav className=\"mr-auto\">\r\n                        {isLogged ? (\r\n                            <>\r\n                                <Nav.Link href=\"\">Профиль</Nav.Link>\r\n                                <Nav.Link href=\"\" onClick={() => addFriendHandler()}>Добавить друга</Nav.Link>\r\n                                <Nav.Link href=\"\">Создать группу</Nav.Link>\r\n                            </>\r\n                        ) : (\r\n                            <div>\r\n\r\n                            </div>\r\n                        )}\r\n                    </Nav>\r\n                    <Form inline>\r\n                        {isLogged ? (\r\n                            <div>\r\n                                <Button\r\n                                    variant=\"outline-info\"\r\n                                    className=\"mr-sm-2\"\r\n                                    onClick={() => exit()}\r\n                                >Выход</Button>\r\n                            </div>\r\n                        ) : (\r\n                            <div>\r\n                                <Button\r\n                                    variant=\"outline-info\"\r\n                                    className=\"mr-sm-2\"\r\n                                    onClick={() => changeCurrentPage(true)}\r\n                                >Войти</Button>\r\n                                <Button\r\n                                    variant=\"outline-info\"\r\n                                    onClick={() => changeCurrentPage(false)}\r\n                                >Регистрация</Button>\r\n                            </div>\r\n                        )}\r\n\r\n                    </Form>\r\n                </Navbar.Collapse>\r\n            </Navbar>\r\n        </animated.div>\r\n    )\r\n}\r\n","export default __webpack_public_path__ + \"static/media/default.6a84b905.jpg\";","import React, {useContext, useEffect, useRef, useState} from 'react'\r\nimport Default from '../images/default.jpg'\r\nimport {ChatContext} from \"../context\";\r\n\r\nconst imageStyle = {\r\n    width: '50px',\r\n    height: '50px',\r\n    borderRadius: '50%'\r\n}\r\nconst style = {\r\n    width: '100%',\r\n    listStyle: 'none',\r\n    marginLeft: 0,\r\n    paddingTop: '20px',\r\n    paddingBottom: '20px',\r\n    paddingRight: '10px',\r\n    borderBottom: '1px solid rgb(0,0,0,0.05)'\r\n}\r\nconst textColor = {\r\n    color: 'grey',\r\n}\r\nconst newMessageCount = {\r\n    borderRadius: '50%',\r\n    width: '30px',\r\n    height: '30px',\r\n    color: 'white'\r\n}\r\n\r\nexport const OneUser = ({ava, username, lastTextParam, time, id, unReaded}) => {\r\n    const ref = useRef(null)\r\n    const [size, setSize] = useState(null)\r\n    const {setChat} = useContext(ChatContext)\r\n    const [lastText, setLastText] = useState(lastTextParam)\r\n\r\n    function chatHandler() {\r\n        setChat(id)\r\n    }\r\n\r\n    useEffect(() => {\r\n        setLastText(lastTextParam)\r\n    }, [lastTextParam])\r\n\r\n    useEffect(() => {\r\n        let width = document.getElementById('lastText').clientWidth\r\n        setSize(Math.round(width / 10))\r\n        let listener = window.addEventListener('resize', () => {\r\n            width = document.getElementById('lastText').clientWidth\r\n            setSize(Math.round(width / 10))\r\n        })\r\n        return () => window.removeEventListener('resize', listener)\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (lastText !== undefined){\r\n            if (lastText.length > size){\r\n                setLastText(lastTextParam.substr(0, size) + '...')\r\n            }\r\n        }\r\n    }, [size, lastText])\r\n\r\n    return (\r\n        <div className='row m-0 one-user' style={style} onClick={() => chatHandler()} key={id}>\r\n            <div className='col-2 p-0 d-flex justify-content-center align-items-center' key={id}>\r\n                {ava !== '' ? (\r\n                    <img src={ava} alt=\"\" style={imageStyle}/>\r\n                ) : (\r\n                    <img src={Default} alt=\"\" style={imageStyle}/>\r\n                )}\r\n            </div>\r\n            <div className='col p-0'>\r\n                <div>\r\n                    {username}\r\n                </div>\r\n                <div ref={ref} style={textColor} id='lastText'>\r\n                    {lastText}\r\n                </div>\r\n            </div>\r\n            <div className='col-1 p-0 d-flex flex-column align-items-center justify-content-end'>\r\n                <div>\r\n                    {unReaded > 0 && (\r\n                        <div className='d-flex justify-content-center align-items-center bg-info' style={newMessageCount}>\r\n                            <div>{unReaded}</div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                <div style={textColor}>\r\n                    {time}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","import React, {useContext, useEffect} from 'react'\r\nimport {OneUser} from \"./OneUser\"\r\nimport {StoreContext} from \"../context\";\r\n\r\nconst style = {\r\n    borderRight: '1px solid #D0D0D0'\r\n}\r\n\r\nexport const Sidebar = () => {\r\n    const {rooms} = useContext(StoreContext)\r\n\r\n    return (\r\n        <div className='m-0 h-100 p-0' style={style}>\r\n            {rooms !== [] ? rooms.map(oneRoom => (\r\n                <OneUser\r\n                    ava={oneRoom.friend.ava}\r\n                    username={oneRoom.friend.username}\r\n                    lastTextParam={oneRoom.messages[oneRoom.messages.length - 1] !== undefined ? oneRoom.messages[oneRoom.messages.length - 1].text : ''}\r\n                    time={oneRoom.messages[oneRoom.messages.length - 1] !== undefined ? oneRoom.messages[oneRoom.messages.length - 1].time : ''}\r\n                    id={oneRoom._id}\r\n                    unReaded={oneRoom.unReaded}\r\n                    />\r\n            )) : (\r\n               <div>У вам пока нет друзей</div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","import React from 'react'\r\nimport Status_3 from '../images/readed-icon.png'\r\n\r\nexport const OneMessage = ({text, time, isMy, key, id, status}) => {\r\n    const Status_0 = 'https://img.icons8.com/carbon-copy/100/000000/clock--v1.png'\r\n    const Status_1 = 'https://img.icons8.com/ios/50/000000/checkmark--v1.png'\r\n    const Status_2 = 'https://img.icons8.com/ios-filled/50/000000/double-tick.png'\r\n\r\n    const messageStyle = {\r\n        maxWidth: '60%',\r\n        borderRadius: '8px',\r\n        backgroundColor: isMy ? '#2284FF' : '#F1F0F0',\r\n        color: isMy ? 'white' : 'black'\r\n    }\r\n\r\n    if (isMy === false){\r\n        status = -1\r\n    }\r\n\r\n    return (\r\n        <div className='d-flex flex-column w-100 p-1' style={{alignItems: isMy ? 'flex-end' : 'flex-start'}} key={key} id={id}>\r\n            <div className='p-2' style={messageStyle}>\r\n                <div>\r\n                    {text}\r\n                </div>\r\n            </div>\r\n            <div className='d-flex'>\r\n                <div style={{color: 'grey', fontSize: '12px', marginRight: '10px'}}>\r\n                    {time}\r\n                </div>\r\n                {status === 0 ? (\r\n                    <img src={Status_0} alt='status' style={{width: '15px', height: '15px'}}/>\r\n                ) : status === 1 ? (\r\n                    <img src={Status_1} alt='status' style={{width: '15px', height: '15px', transform: 'rotate(5deg)'}}/>\r\n                ) : status === 2 ? (\r\n                    <img src={Status_2} alt='status' style={{width: '15px', height: '15px'}}/>\r\n                ) : status === 3 ? (\r\n                    <img src={Status_3} alt='status' style={{width: '15px', height: '15px'}}/>\r\n                ) : (\r\n                    <div />\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAADvElEQVRoge2YTWgcZRjH/8873bTWgm0PitgqmpnY0kttdrMNhR6KUAQpFhNqpNQGtDOBBovgx6UqePBSKkjDftQvJKJJi6SVUhAKimJNdxa8pJDdTQuuUnqIFg/GJrPzeDDBdybZ3XlnN7s9zO/439/OPn/mnXlfFoiIiIiIiIgAtXsAmV2pwrMClAGhAkGmfUy/HNS9Z4rEU9M9IPE9gHWLUdm2jEeDuqIVQ9ajNzX9CEibwP+DAQRXxW17kd7T5fsWSEwA/LAUMzG9qeK2twgzLay/+zGAuDfH+zlLH1Nx21okkSmdBHjAF1+wb+snVd22FelJlQ4y8I6cMXBdm8cRvEuuqtuWt1YiW9jJLv0I4H4pnmVCMm8aM2Hclt+R5NkbD7FLF3yDLYDR5y+h4ra0yI7xqY5KpTIOwLM/ENFxe8j4LqwLtLjI+tmOEQB7PSHhg5ypZxtxgRYWiWcKrzPhZV/87YZbv73RiLtESx72XanifkG4BECTfnraWavt/mXw8TthXZlVL9Kdmd5GLH4G8ID0o38KiOSk1VkM6/pZ1aXV+9HUZoL4Rh4MgAOIfv9gKu5KrGnOyMvpztgxx+k4B0D3fEA4kTM7r4R1q7Fqd4R444cM7POG+MQ2jZFG3GqsSpHudGkYYEvOCPTD3Kb5oUbcWlA8W3oGLmcBgImG86Y+EWb4JRLZwtPs0mV4l+2McJzktePbZ8O69RCLJbYA2ELM5xLp0qGwJZLpGQMujfsG+0sDDvgHU3GD4F9aaxg8GqbMzk9vbqzAvcjAJimuMPGLk5ZxPawbFMFEwwAcKVMu0z/OWuyu8xWAbXJOoLfyZtelsK4KYvGZGMDyMl8k0sXDQS5y84/SKQb2++LPc5Z+qhFXBQEAtmWcx/IyGgOf1SuTSBWOAjjhCRk/3ZnHsUZcVTxHlHi62AfgS3gfwAoBR3OWMer/cjxV2gPiKwDWSvGvmqb1TL7yxO2wbhg8D7vKnXnqzI3HiPhr32BzAuJ5/2AqblOKAMHK7BiZ2qDFnIsMPCg5TKDBa1anLV9PxW2EqqffRLp0iMGj8C4zB+AjIHoBjAOyz8Rv582u9+QNlsCvMtFL1dxmlahZBKhaZiXGbFMfABHH08Uy/ttg67qqw9ai5lkrZ+ljBDoM7zLzY8f+XjcYcDAVV4m6h8baZehWjN3nrr62dW4pWWGDreo2k0Cn38W/L/0vgH+Y3INXh578XXarbLArus0k8DHetozzTNQPoAygzMR9ebNrslE3IiIiIiLiXuBf/msgy1as/bgAAAAASUVORK5CYII=\"","import io from 'socket.io-client'\r\n\r\nconst socket = io()\r\n\r\nexport default socket\r\n","import React, {useCallback, useContext, useEffect, useRef, useState} from 'react'\r\nimport {OneMessage} from \"./OneMessage\"\r\nimport {ChatContext, StoreContext} from \"../context\";\r\nimport {useCookies} from \"react-cookie\";\r\nimport {addMessage, addOneMessage, changeAllLoaded, changeLoaded, removeUnReaded} from \"../redux/actions\";\r\nimport axios from \"axios\";\r\nimport {Spinner} from \"react-bootstrap\";\r\nimport socket from '../socket';\r\n\r\nlet skipCount = 0\r\nlet isFirst = true\r\nlet allLoaded = false\r\nlet canScroll = false\r\nlet currentChat = ''\r\nlet canScrollToLast = false\r\n\r\nexport const MessageBlock = () => {\r\n    const messageRef = useRef(null)\r\n    const [cookie] = useCookies()\r\n    const {rooms, dispatch} = useContext(StoreContext)\r\n    const [messages, setMessages] = useState([])\r\n    const [loading, setLoading] = useState(false)\r\n    const {chat} = useContext(ChatContext)\r\n\r\n    useEffect(() => {\r\n        if (currentChat !== ''){\r\n            let lastMessage = Math.ceil(document.getElementById('messageBlock').scrollTop + document.getElementById('messageBlock').clientHeight)\r\n            let scroll = document.getElementById('messageBlock').scrollHeight\r\n            if (scroll - lastMessage < 30){\r\n                canScroll = true\r\n            }\r\n            rooms.forEach(oneRoom => {\r\n                if (oneRoom._id === chat){\r\n                    allLoaded = oneRoom.allLoaded\r\n                    setMessages([...oneRoom.messages])\r\n                    if (oneRoom.unReaded !== 0){\r\n                        dispatch(removeUnReaded(currentChat))\r\n                    }\r\n                    oneRoom.messages.forEach(oneMessage => {\r\n                        if (oneMessage.status === 2 && oneMessage.user_id !== cookie.id){\r\n                            socket.emit('readed', oneMessage._id)\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n    }, [rooms])\r\n\r\n    useEffect(() => {\r\n        if (currentChat !== ''){\r\n            skipCount = messages.length\r\n            console.log(skipCount)\r\n            if (isFirst){\r\n                messageRef.current.scrollIntoView()\r\n                isFirst = false\r\n            }\r\n            else if (canScroll){\r\n                messageRef.current.scrollIntoView()\r\n                canScroll = false\r\n            }\r\n            else if (canScrollToLast){\r\n                document.getElementById('messageBlock').scrollTop = document.getElementById('scroll').offsetTop\r\n                canScrollToLast = false\r\n            }\r\n            // else if (messages[messages.length - 1].user_id === cookie.id){\r\n            //     messageRef.current.scrollIntoView({behavior: 'smooth'})\r\n            // }\r\n        }\r\n    }, [messages])\r\n\r\n    useEffect(() => {\r\n        if (chat !== ''){\r\n            currentChat = chat\r\n            if (rooms !== []){\r\n                rooms.forEach(oneRoom => {\r\n                    if (oneRoom._id === chat){\r\n                        allLoaded = oneRoom.allLoaded\r\n                        skipCount = oneRoom.messages.length\r\n                        setMessages([...oneRoom.messages])\r\n                        oneRoom.messages.forEach(oneMessage => {\r\n                            if (oneMessage.status === 2 && oneMessage.user_id !== cookie.id){\r\n                                socket.emit('readed', oneMessage._id)\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n            let loaded = false\r\n            rooms.forEach(oneRoom => {\r\n                if (oneRoom._id === chat){\r\n                    loaded = oneRoom.loaded\r\n                }\r\n            })\r\n            if (loaded === false && allLoaded === false){\r\n                const findData = {\r\n                    room_id: chat,\r\n                    skip: skipCount,\r\n                    limit: 20\r\n                }\r\n                setLoading(true)\r\n                axios.post('message/find', findData).then(data => {\r\n                    if (data.data !== false){\r\n                        dispatch(addMessage(chat, data.data))\r\n                        setLoading(false)\r\n                        if (data.data.length < 20){\r\n                            dispatch(changeAllLoaded(currentChat))\r\n                        }\r\n                    }\r\n                    else {\r\n                        setLoading(false)\r\n                    }\r\n                    dispatch(changeLoaded(chat))\r\n                })\r\n            }\r\n        }\r\n\r\n\r\n        return () => {\r\n            skipCount = 0\r\n            isFirst = true\r\n            allLoaded = false\r\n            canScroll = false\r\n            canScrollToLast = false\r\n        }\r\n    }, [chat])\r\n\r\n    useEffect(() => {\r\n        let messageBlcok = document.getElementById('messageBlock')\r\n        let listener = (e) => {\r\n            if (e.target.scrollTop === 0 && currentChat  !== '' && e.target.scrollHeight > e.target.clientHeight){\r\n                const findData = {\r\n                    room_id: currentChat,\r\n                    skip: skipCount,\r\n                    limit: 20\r\n                }\r\n                if (allLoaded === false){\r\n                    setLoading(true)\r\n                    axios.post('message/find', findData).then(data => {\r\n                        if (data.data !== false && data.data !== null){\r\n                            data.data[data.data.length - 1].isLast = true\r\n                            canScrollToLast = true\r\n                            dispatch(addMessage(currentChat, data.data))\r\n                            setLoading(false)\r\n                            if (data.data.length < 20){\r\n                                dispatch(changeAllLoaded(currentChat))\r\n                            }\r\n                        }\r\n                        else {\r\n                            allLoaded = true\r\n                            setLoading(false)\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        messageBlcok.addEventListener('scroll', listener)\r\n    }, [])\r\n\r\n    return (\r\n        <div className='w-100 p-1' style={{flexBasis: '90%', overflow: 'auto'}} id='messageBlock'>\r\n            {loading && (\r\n                <div className='d-flex justify-content-center mt-3'>\r\n                    <Spinner animation=\"grow\" size='sm' variant='info'/>\r\n                    <Spinner animation=\"grow\" size='sm' variant='info'/>\r\n                    <Spinner animation=\"grow\" size='sm' variant='info'/>\r\n                </div>\r\n            )}\r\n            {messages !== [] ? messages.map(oneMessage => {\r\n                if (oneMessage.isLast){\r\n                    return (\r\n                        <OneMessage\r\n                            id='scroll'\r\n                            text={oneMessage.text}\r\n                            time={oneMessage.time}\r\n                            isMy={oneMessage.user_id === cookie.id}\r\n                            status={oneMessage.status}\r\n                            key={oneMessage.local_id}\r\n                        />\r\n                    )\r\n                }\r\n                else {\r\n                    return (\r\n                        <OneMessage\r\n                            text={oneMessage.text}\r\n                            time={oneMessage.time}\r\n                            isMy={oneMessage.user_id === cookie.id}\r\n                            status={oneMessage.status}\r\n                            key={oneMessage.local_id}\r\n                        />\r\n                    )\r\n                }\r\n            }) : (<div />)}\r\n            <div ref={messageRef} id='lastMessage' />\r\n        </div>\r\n    )\r\n}\r\n","import React, {useContext, useEffect, useRef, useState} from 'react'\r\nimport {ChatContext, StoreContext} from \"../context\";\r\nimport {useCookies} from \"react-cookie\";\r\nimport {addMessage, addOneMessage, changeRoom} from \"../redux/actions\";\r\nimport socket from \"../socket\";\r\n\r\nlet currentChat = ''\r\n\r\nexport const MessageInput = () => {\r\n    const [size, setSize] = useState(0)\r\n    const [cookie, setCookie] = useCookies()\r\n    const {dispatch} = useContext(StoreContext)\r\n    const textRef = useRef('')\r\n    const {chat} = useContext(ChatContext)\r\n    const textStyle = {\r\n        width: '95%',\r\n        resize: 'none',\r\n        height: '70%',\r\n        padding: '10px',\r\n        borderRadius: '20px',\r\n        outline: 'none',\r\n        borderColor: '#C0C0C0'\r\n    }\r\n\r\n    function sendHandler() {\r\n        if (textRef.current !== null){\r\n            const text = textRef.current.value.trim()\r\n            if (text !== ''){\r\n                const date = new Date()\r\n                const message = {\r\n                    local_id: Date.now().toString(),\r\n                    room_id: currentChat,\r\n                    user_id: cookie.id,\r\n                    status: 0,\r\n                    text,\r\n                    time: date.getHours() + ':' + date.getMinutes()\r\n                }\r\n                dispatch(changeRoom())\r\n                dispatch(addOneMessage(currentChat, message))\r\n                socket.emit('message', message)\r\n                textRef.current.value = ''\r\n                setSize(0)\r\n            }\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        let listener\r\n        currentChat = chat\r\n        if (currentChat !== ''){\r\n            listener = document.addEventListener('keypress', (e) => {\r\n                if (e.keyCode === 13){\r\n                    e.preventDefault()\r\n                    sendHandler()\r\n                }\r\n            })\r\n        }\r\n        return () => document.removeEventListener('keypress', listener)\r\n    }, [chat])\r\n\r\n    useEffect(() => {\r\n        if (size >= 50){\r\n            document.getElementById('messageBlock').scrollTop = document.getElementById('messageBlock').scrollHeight\r\n            \r\n        }\r\n    }, [size])\r\n\r\n    return (\r\n        <div className='d-flex justify-content-end pl-2 pr-2' id='textarea' style={{flexBasis: size < 50 ? '10%' : '30%', backgroundColor: '#F0F0F0'}}>\r\n            <div className='h-100 d-flex w-100 align-items-center'>\r\n                <textarea onChange={(e) => setSize(e.target.value.length)} ref={textRef} style={textStyle} placeholder='Введите сообщение'/>\r\n                <img className='send' onClick={() => sendHandler()} src=\"https://img.icons8.com/dotty/80/000000/paper-plane.png\" alt='send' style={{width: '5%'}}/>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","import React, {useContext, useEffect} from 'react'\r\nimport {ChatContext} from \"../context\";\r\nimport {MessageBlock} from \"./MessageBlock\";\r\nimport {MessageInput} from \"./MessageInput\";\r\n\r\nconst style = {\r\n}\r\n\r\nexport const Main = () => {\r\n    const {chat} = useContext(ChatContext)\r\n\r\n    return (\r\n        <div className='m-0 p-0 h-100' style={style}>\r\n            {chat !== '' ? (\r\n                <div className='h-100 d-flex flex-column'>\r\n                    <MessageBlock chat={chat}/>\r\n                    <MessageInput/>\r\n                </div>\r\n            ) : (\r\n                <div />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","import React, {useEffect, useState} from 'react'\r\nimport {Row} from \"react-bootstrap\";\r\nimport {Sidebar} from \"./Sidebar\";\r\nimport {Main} from \"./Main\";\r\nimport {useSpring, animated} from \"react-spring\";\r\nimport {ChatContext} from \"../context\";\r\n\r\nconst style = {\r\n    height: '90%',\r\n}\r\n\r\nexport const Logged = ({loading, rooms, setCurrentChat}) => {\r\n    const [sideBar, setSideBar, stopSideBar] = useSpring(() => ({\r\n        transform: 'translateX(-100%)'\r\n    }))\r\n    const [header, setHeader, stopHeader] = useSpring(() => ({\r\n        transform: 'translateX(100%)'\r\n    }))\r\n    const [chat, setChat] = useState('')\r\n\r\n    useEffect(() => {\r\n        setCurrentChat(chat)\r\n    }, [chat])\r\n\r\n    useEffect(() => {\r\n        if (loading === false){\r\n            setSideBar({\r\n                transform: 'translateX(0%)'\r\n            })\r\n            setHeader({\r\n                transform: 'translateX(0%)'\r\n            })\r\n        }\r\n        stopSideBar()\r\n        stopHeader()\r\n    }, [loading])\r\n\r\n    return (\r\n        <ChatContext.Provider value={{chat, setChat}}>\r\n            <div style={style} className='row m-0 p-0'>\r\n                <animated.div className='col-4 p-0 m-0 h-100' style={sideBar}>\r\n                    <Sidebar rooms={rooms}/>\r\n                </animated.div>\r\n                <animated.div className='col p-0 m-0 h-100' style={header}>\r\n                    <Main />\r\n                </animated.div>\r\n            </div>\r\n        </ChatContext.Provider>\r\n    )\r\n}\r\n","import React, {useRef, useState} from 'react'\r\nimport {Button, Card, Form, Alert, Spinner} from \"react-bootstrap\";\r\nimport axios from \"axios\";\r\nimport {useCookies} from \"react-cookie\";\r\n\r\nconst style = {\r\n    width: '80%'\r\n}\r\n\r\nexport const Login = () => {\r\n    const email = useRef('')\r\n    const password = useRef('')\r\n    const [error, setError] = useState(null)\r\n    const [cookie, setCookie] = useCookies()\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    function loginHandler() {\r\n        const findData = {\r\n            email: email.current.value.trim(),\r\n            password: password.current.value.trim()\r\n        }\r\n        if (findData.email.length === 0){\r\n            setError('Введите email')\r\n        }\r\n        else if (findData.password.length === 0){\r\n            setError('Введите пароль')\r\n        }\r\n        else {\r\n            setLoading(true)\r\n            axios.post('/user/login', findData)\r\n                .then(data => {\r\n                    setLoading(false)\r\n                    if (data.data === false){\r\n                        setError('Такого пользователя нет')\r\n                    }\r\n                    else {\r\n                        setCookie('id', data.data)\r\n                    }\r\n                })\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div style={style}>\r\n            <Card style={{ width: '100%' }}>\r\n                <Card.Body>\r\n                    <Card.Title><h2>Вход</h2></Card.Title>\r\n                    <Card.Subtitle>\r\n                        {error && (\r\n                            <Alert variant='danger'>\r\n                                {error}\r\n                            </Alert>\r\n                        )}\r\n                    </Card.Subtitle>\r\n                    <Card.Text>\r\n                        <Form>\r\n                            <Form.Group controlId=\"formBasicEmail\">\r\n                                <Form.Label>Email</Form.Label>\r\n                                <Form.Control ref={email} type=\"email\" placeholder=\"Введите email\" />\r\n                            </Form.Group>\r\n\r\n                            <Form.Group controlId=\"formBasicPassword\">\r\n                                <Form.Label>Пароль</Form.Label>\r\n                                <Form.Control ref={password} type=\"password\" placeholder=\"Введите пароль\" />\r\n                            </Form.Group>\r\n                            <Form.Group controlId=\"formBasicCheckbox\">\r\n                                <Form.Check type=\"checkbox\" label=\"Запоминить меня\" />\r\n                            </Form.Group>\r\n                            {loading ? (\r\n                                <Button variant=\"primary\" type=\"button\" disabled>\r\n                                    <Spinner animation='grow' variant='info' size='sm' />\r\n                                    <Spinner animation='grow' variant='info' size='sm' />\r\n                                    <Spinner animation='grow' variant='info' size='sm' />\r\n                                </Button>\r\n                            ) : (\r\n                                <Button variant=\"primary\" type=\"button\" onClick={() => loginHandler()}>\r\n                                    Войти\r\n                                </Button>\r\n                            )}\r\n                        </Form>\r\n                    </Card.Text>\r\n                    <Card.Link>Забыли пароль?</Card.Link>\r\n                </Card.Body>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n","import React, {useRef, useState} from 'react'\r\nimport {Alert, Button, Card, Form, Spinner} from \"react-bootstrap\";\r\nimport axios from \"axios\"\r\nimport {useCookies} from 'react-cookie'\r\n\r\nconst style = {\r\n    width: '80%'\r\n}\r\n\r\nexport const SignIn = () => {\r\n    const email = useRef('')\r\n    const username = useRef('')\r\n    const password = useRef('')\r\n    const password_2 = useRef('')\r\n    const [error, setError] = useState(null)\r\n    const [cookie, setCookie] = useCookies()\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    function signInHandler() {\r\n        const findData = {\r\n            email: email.current.value.trim(),\r\n            username: username.current.value.trim(),\r\n            password: password.current.value.trim()\r\n        }\r\n        if (findData.username.length < 5){\r\n            setError('Имя пользователя должна быть не менее 5 символов')\r\n        }\r\n        else if (findData.email.length < 5){\r\n            setError('Email должен быть не менее 5 символов')\r\n        }\r\n        else if (findData.password.length < 6){\r\n            setError('Пароль должен быть не менее 6 символов')\r\n        }\r\n        else if (password_2.current.value.trim() === 0){\r\n            setError('Введите повторный пароль')\r\n        }\r\n        else if (password_2.current.value.trim() !== findData.password){\r\n            setError('Пароли не совпадают')\r\n        }\r\n        else {\r\n            const addData = {\r\n                email: findData.email,\r\n                username: findData.username,\r\n                password: findData.password\r\n            }\r\n            setLoading(true)\r\n            axios.post('/user/check', {email: findData.email, username: findData.username}).then(data => {\r\n                if (data.data !== true){\r\n                    setError(data.data)\r\n                    setLoading(false)\r\n                }\r\n                else {\r\n                    setLoading(true)\r\n                    axios.post('/user/add', findData).then(id => {\r\n                        setLoading(false)\r\n                        setCookie('id', id.data)\r\n                    })\r\n                }\r\n            })\r\n        }\r\n    }\r\n    return (\r\n        <div style={style}>\r\n            <Card style={{ width: '100%' }}>\r\n                <Card.Body>\r\n                    <Card.Title><h2>Регистрация</h2></Card.Title>\r\n                    <Card.Subtitle>\r\n                        {error && (\r\n                            <Alert variant='danger'>\r\n                                {error}\r\n                            </Alert>\r\n                        )}\r\n                    </Card.Subtitle>\r\n                    <Card.Text>\r\n                        <Form>\r\n                            <Form.Group controlId=\"formBasicEmail\">\r\n                                <Form.Label>Email</Form.Label>\r\n                                <Form.Control ref={email} type=\"email\" placeholder=\"Введите email\" />\r\n                            </Form.Group>\r\n                            <Form.Group controlId=\"formBasicEmail\">\r\n                                <Form.Label>Имя пользователя</Form.Label>\r\n                                <Form.Control ref={username} type=\"email\" placeholder=\"Введите имя пользователя\" />\r\n                            </Form.Group>\r\n                            <Form.Group controlId=\"formBasicPassword\">\r\n                                <Form.Label>Пароль</Form.Label>\r\n                                <Form.Control ref={password} type=\"password\" placeholder=\"Введите пароль\" />\r\n                            </Form.Group>\r\n                            <Form.Group controlId=\"formBasicPassword\">\r\n                                <Form.Label>Повтрный пароль</Form.Label>\r\n                                <Form.Control ref={password_2} type=\"password\" placeholder=\"Введите повторный пароль\" />\r\n                            </Form.Group>\r\n                            {loading ? (\r\n                                <Button variant=\"primary\" type=\"button\" disabled>\r\n                                    <Spinner animation='grow' variant='info' size='sm' />\r\n                                    <Spinner animation='grow' variant='info' size='sm' />\r\n                                    <Spinner animation='grow' variant='info' size='sm' />\r\n                                </Button>\r\n                            ) : (\r\n                                <Button variant=\"primary\" type=\"button\" onClick={() => signInHandler()}>\r\n                                    Зарегистрироваться\r\n                                </Button>\r\n                            )}\r\n                        </Form>\r\n                    </Card.Text>\r\n                </Card.Body>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n","import React, {useEffect} from 'react'\r\nimport {Login} from \"./Login\";\r\nimport {SignIn} from \"./SignIn\";\r\nimport {useSpring, animated} from \"react-spring\";\r\n\r\nconst style = {\r\n    height: '90%'\r\n}\r\n\r\nexport const UnLogged = ({currentPage}) => {\r\n    const [loginAnim, setLoginAnim, stopLoginAnim] = useSpring(() => ({\r\n        width: '100vw',\r\n        transform: 'translateX(50%)',\r\n        opacity: 1\r\n    }))\r\n    const [signInAnim, setSignInAnim, stopSignInAnim] = useSpring(() => ({\r\n        width: '100vw',\r\n        transform: 'translateX(100%)',\r\n        opacity: 0\r\n    }))\r\n\r\n    useEffect(() => {\r\n        if (currentPage){\r\n            setLoginAnim({transform: 'translateX(50%)', opacity: 1})\r\n            setSignInAnim({transform: 'translateX(100%)', opacity: 0})\r\n        }\r\n        else {\r\n            setLoginAnim({transform: 'translateX(-100%)', opacity: 0})\r\n            setSignInAnim({transform: 'translateX(-50%)', opacity: 1})\r\n        }\r\n        stopLoginAnim()\r\n        stopSignInAnim()\r\n    }, [currentPage])\r\n\r\n    return (\r\n        <div className='d-flex align-items-center bg-light' style={style}>\r\n\r\n            <animated.div style={loginAnim} className='d-flex justify-content-center'>\r\n                <Login />\r\n            </animated.div>\r\n\r\n            <animated.div style={signInAnim} className='w-100 d-flex justify-content-center'>\r\n                <SignIn />\r\n            </animated.div>\r\n\r\n        </div>\r\n    )\r\n}\r\n","import axios from \"axios\";\r\n\r\nexport const roomReducer = (state = [], action) => {\r\n    switch (action.type){\r\n        case 'deleteRooms':\r\n            state = []\r\n            return state\r\n        case 'addRoom':\r\n            action.payload.rooms.map(oneRoom => {\r\n                oneRoom.messages = []\r\n                oneRoom.friend = {}\r\n                oneRoom.loaded = false\r\n                oneRoom.allLoaded = false\r\n                oneRoom.unReaded = 0\r\n            })\r\n            return state.concat(action.payload.rooms)\r\n        case 'addMessage':\r\n            let newState3 = [...state]\r\n            newState3.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.messages = action.payload.messages.concat(oneRoom.messages)\r\n                }\r\n                return oneRoom\r\n            })\r\n            return newState3\r\n        case 'addOneMessage':\r\n            let newState = [...state]\r\n            newState.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.messages.push(action.payload.message)\r\n                    oneRoom.time = Date.now()\r\n                    axios.get(`/room/time/${oneRoom._id}`)\r\n                    if (action.payload.message.status === 1 && action.payload.message.user_id === oneRoom.friend.id && action.payload.currentChat !== oneRoom._id){\r\n                        oneRoom.unReaded = oneRoom.unReaded + 1\r\n                        console.log('Onee')\r\n                    }\r\n                }\r\n                return oneRoom\r\n            })\r\n            newState.sort((a, b) => {\r\n                return a.time - b.time\r\n            })\r\n            newState.reverse()\r\n            return newState\r\n        case 'addLastMessage':\r\n            state.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.messages = action.payload.lastMessage\r\n                }\r\n                return oneRoom\r\n            })\r\n            state.sort((a, b) => {\r\n                return a.time - b.time\r\n            })\r\n            state.reverse()\r\n            return state\r\n        case 'addFriend':\r\n            return state.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.friend = action.payload.friend\r\n                }\r\n                return oneRoom\r\n            })\r\n        case 'updateStatus':\r\n            let newState2 = [...state]\r\n            newState2.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    return oneRoom.messages.map(oneMessage => {\r\n                        if (oneMessage.local_id === action.payload.localId){\r\n                            oneMessage.status = action.payload.status\r\n                        }\r\n                        return oneMessage\r\n                    })\r\n                }\r\n            })\r\n            return newState2\r\n        case 'setUnReaded':\r\n            return state.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.unReaded = action.payload.unReaded\r\n                }\r\n                return oneRoom\r\n            })\r\n        case 'removeUnReaded':\r\n            return state.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.unReaded = 0\r\n                }\r\n                return oneRoom\r\n            })\r\n        case 'loaded':\r\n            return state.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.loaded = true\r\n                }\r\n                return oneRoom\r\n            })\r\n        case 'allLoaded':\r\n            return state.map(oneRoom => {\r\n                if (oneRoom._id === action.payload.roomId){\r\n                    oneRoom.allLoaded = true\r\n                }\r\n                return oneRoom\r\n            })\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport const profileReducer = (state, action) => {\r\n    switch (action.type){\r\n        case 'addProfile':\r\n            return action.payload.profile\r\n        default:\r\n            return state\r\n    }\r\n}\r\n","import 'bootstrap/dist/css/bootstrap.min.css'\nimport {Header} from \"./components/Header\";\nimport {Logged} from \"./components/Logged\";\nimport {UnLogged} from \"./components/UnLogged\";\nimport {useEffect, useReducer, useState} from \"react\";\nimport {useSpring, animated} from \"react-spring\";\nimport {Spring} from \"react-spring/renderprops-universal\";\nimport {ProgressBar, Spinner} from \"react-bootstrap\";\nimport './App.css'\nimport {addOneMessage, addProfile, addRoom, deleteRooms, updateStatus} from \"./redux/actions\";\nimport {profileReducer, roomReducer} from \"./redux/reducers\";\nimport {useCookies} from \"react-cookie\";\nimport axios from \"axios\";\nimport {StoreContext} from \"./context\";\nimport socket from \"./socket\";\nimport UseRoom from \"./UseRoom\";\n\nconst mainBlock = {\n    width: '100vw',\n    height: '100vh'\n}\n\nconst loadingStyle = {\n    top: 0,\n    left: 0,\n    position: 'absolute',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    width: '100%',\n    height: '100%'\n}\n\nlet localRooms = []\nlet chat = ''\n\nfunction App() {\n    const [loading, setLoading] = useState(null)\n    const [isLogged, setIsLogged] = useState(false)\n    const [currentPage, setCurrentPage] = useState(true)\n    const [cookie] = useCookies()\n    const [progress, setProgress] = useState(0)\n\n    const [rooms, dispatch] = useReducer(roomReducer,[])\n    const [profile, profileDispatch] = useReducer(profileReducer, {})\n\n    const [unLogged, setUnLogged, stopUnLogged] = useSpring(() => ({\n        transform: 'translateY(100%)'\n    }))\n\n    async function getData() {\n        const findRooms = await axios.get(`room/find/${cookie.id}`)\n        setProgress(20)\n        const findProfile = await axios.get(`user/profile/${cookie.id}`)\n        setProgress(60)\n        profileDispatch(addProfile(findProfile.data))\n        if (findRooms.data !== false){\n            dispatch(addRoom(findRooms.data))\n            await UseRoom(findRooms.data, dispatch, cookie.id)\n            setProgress(100)\n        }\n    }\n\n    useEffect(() => {\n        if (cookie.id !== '' && cookie.id){\n            setIsLogged(true)\n            setLoading(true)\n            getData().then(() => {\n                setTimeout(() => {\n                    setLoading(false)\n                }, 500)\n            })\n\n        }\n        else {\n            setIsLogged(false)\n        }\n    }, [cookie])\n\n    useEffect(() => {\n        if (loading){\n            setUnLogged({\n                transform: 'translateY(100%)'\n            })\n        }\n        else {\n            setUnLogged({\n                transform: 'translateY(0%)'\n            })\n        }\n        stopUnLogged()\n    }, [loading])\n\n    useEffect(() => {\n        socket.on('newMessage', data => {\n            if (localRooms !== [] && cookie.id){\n                localRooms.map(oneRoom => {\n                    if (data.user_id === oneRoom.friend.id && data.room_id === oneRoom._id){\n                        dispatch(addOneMessage(oneRoom._id, data, chat))\n                    }\n                })\n            }\n        })\n        socket.on('updateStatus', data => {\n            if (localRooms !== [] && cookie.id){\n                localRooms.forEach(oneRoom => {\n                    if (data.room_id === oneRoom._id && data.status){\n                        oneRoom.messages.forEach(oneMessage => {\n                            if (oneMessage.local_id === data.local_id && data.status >= oneMessage.status){\n                                dispatch(updateStatus(data.room_id, data.local_id, data.status))\n                            }\n                        })\n                    }\n                })\n            }\n        })\n        return () => {\n            dispatch(deleteRooms())\n            socket.removeAllListeners()\n        }\n    }, [])\n\n    useEffect(() => {\n        localRooms = rooms\n        if (localRooms !== []){\n            localRooms.map(oneRoom => {\n                oneRoom.messages.map(oneMessage => {\n                    if (oneMessage.user_id !== cookie.id && oneMessage.status === 1){\n                        socket.emit('here', oneMessage._id)\n                        dispatch(updateStatus(oneRoom._id, oneMessage.local_id, 2))\n                    }\n                })\n            })\n        }\n        return () => {\n            localRooms = []\n        }\n    }, [rooms])\n\n    function changeCurrentPage(page) {\n        setCurrentPage(page)\n    }\n\n    function setCurrentChat(curChat) {\n        chat = curChat\n    }\n\n    return (\n        <StoreContext.Provider value={{rooms, dispatch}}>\n            <div style={mainBlock}>\n                <Header isLogged={isLogged} changeCurrentPage={changeCurrentPage} currentPage={currentPage} loading={loading}/>\n                {isLogged ? (\n                    <Logged loading={loading} rooms={rooms} setCurrentChat={setCurrentChat}/>\n                ) : (\n                    <animated.div className='h-100' style={unLogged}>\n                        <UnLogged currentPage={currentPage}/>\n                    </animated.div>\n                )}\n                {loading === true ? (\n                    <div style={loadingStyle}>\n                        <Spring\n                            from={{opacity: 0}}\n                            to={{opacity: 1}}\n                        >\n                            {props => (\n                                <div style={props} className='w-100 d-flex justify-content-center'>\n                                    <div className='w-50 d-flex align-items-center flex-column'>\n                                        <Spinner animation=\"border\" role=\"status\" variant='info'>\n                                            <span className=\"sr-only\">Loading...</span>\n                                        </Spinner>\n                                        <div className='w-75 m-5'>\n                                            <ProgressBar now={progress} />\n                                        </div>\n                                    </div>\n                                </div>\n                            )}\n                        </Spring>\n                    </div>\n                ) : (\n                    <div>\n                    </div>\n                )}\n            </div>\n        </StoreContext.Provider>\n    )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n    <App />,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}